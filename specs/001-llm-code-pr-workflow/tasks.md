# Tasks: LLM Code Generation Workflow

**Input**: Design documents from `/specs/001-llm-code-pr-workflow/`
**Prerequisites**: plan.md ‚úÖ, spec.md ‚úÖ, research.md ‚úÖ, data-model.md ‚úÖ, contracts/ ‚úÖ

**Tests**: Tests are NOT requested in the feature specification. Manual workflow testing via GitHub Actions UI serves as validation.

**Organization**: Tasks are organized by user story, though Claude Code GitHub Actions handles all operations (code generation, branch creation, commits, PR creation) internally in a single step.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3)
- Include exact file paths in descriptions

## Path Conventions

- **Infrastructure/DevOps**: `.github/workflows/` at repository root
- Single workflow file structure per plan.md: `.github/workflows/llm-code-generation.yml`

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Create workflow directory structure and initialize workflow file

- [ ] T001 Create `.github/workflows/` directory structure at repository root
- [ ] T002 Initialize workflow file `.github/workflows/llm-code-generation.yml` with basic workflow structure (name, empty jobs section)

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Configure workflow triggers and permissions required for Claude Code Action

**‚ö†Ô∏è CRITICAL**: No user story work can begin until this phase is complete

- [ ] T003 Configure workflow trigger (`workflow_dispatch`) with prompt input in `.github/workflows/llm-code-generation.yml`
- [ ] T004 Configure workflow permissions (contents: write, pull-requests: write, issues: write) in `.github/workflows/llm-code-generation.yml`
- [ ] T005 Configure job structure (single job: `generate-code`) with `runs-on: ubuntu-latest` in `.github/workflows/llm-code-generation.yml`

**Checkpoint**: Foundation ready - user story implementation can now begin

---

## Phase 3: User Story 1 - Generate Code from Prompt (Priority: P1) üéØ MVP

**Goal**: Configure Claude Code GitHub Actions to accept a prompt input and generate code automatically

**Independent Test**: Manually trigger the workflow with a prompt via GitHub Actions UI and verify that code is generated by Claude Code Action. Check workflow logs to confirm LLM API call succeeds.

**Note**: Claude Code Action handles code generation, branch creation, commits, and PR creation internally. This phase configures the action to enable all three user stories.

### Implementation for User Story 1

- [ ] T006 [US1] Add Claude Code Action step (`anthropics/claude-code-action@v1`) to generate-code job in `.github/workflows/llm-code-generation.yml`
- [ ] T007 [US1] Configure prompt input (`prompt: ${{ inputs.prompt }}`) in Claude Code Action step in `.github/workflows/llm-code-generation.yml`
- [ ] T008 [US1] Configure Anthropic API key secret (`anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}`) in Claude Code Action step in `.github/workflows/llm-code-generation.yml`
- [ ] T009 [US1] Configure Claude model selection (`claude_args: --model claude-sonnet-4-5-20250929`) in Claude Code Action step in `.github/workflows/llm-code-generation.yml`
- [ ] T010 [US1] Configure max turns (`claude_args: --max-turns 10`) in Claude Code Action step in `.github/workflows/llm-code-generation.yml`

**Checkpoint**: At this point, User Story 1 should be fully functional. Claude Code Action will generate code from prompts. User Stories 2 and 3 are automatically handled by Claude Code Action (branch creation, commits, PR creation).

---

## Phase 4: User Story 2 - Apply Generated Code to Codebase (Priority: P2)

**Goal**: Claude Code Action automatically applies generated code to a new branch and commits it

**Independent Test**: Verify that after code generation, a new branch is created and the generated code is committed to that branch. Check GitHub repository branches and commits.

**Note**: This functionality is handled automatically by Claude Code Action. No additional configuration needed beyond Phase 3. This phase documents the behavior and validates it works.

### Validation for User Story 2

- [ ] T011 [US2] Verify Claude Code Action creates branch automatically (check workflow logs and repository branches)
- [ ] T012 [US2] Verify Claude Code Action commits generated code files (check repository commits and file changes)
- [ ] T013 [US2] Verify branch naming follows expected pattern (check branch names created by action)

**Checkpoint**: At this point, User Stories 1 AND 2 should both work. Code is generated and committed to branches automatically.

---

## Phase 5: User Story 3 - Create Pull Request for Generated Code (Priority: P3)

**Goal**: Claude Code Action automatically creates a pull request for the generated code

**Independent Test**: Verify that after code is committed to a branch, a pull request is created with appropriate title and description. Check GitHub Pull Requests tab.

**Note**: This functionality is handled automatically by Claude Code Action. No additional configuration needed beyond Phase 3. This phase documents the behavior and validates it works.

### Validation for User Story 3

- [ ] T014 [US3] Verify Claude Code Action creates PR automatically (check GitHub Pull Requests tab)
- [ ] T015 [US3] Verify PR includes appropriate title and description (check PR content)
- [ ] T016 [US3] Verify PR includes original prompt in description (check PR description)
- [ ] T017 [US3] Verify PR includes summary of generated changes (check PR description and file diff)

**Checkpoint**: All user stories should now be independently functional. Complete workflow: prompt ‚Üí code generation ‚Üí branch creation ‚Üí commits ‚Üí PR creation.

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: Documentation, configuration improvements, and validation

- [ ] T018 [P] Add workflow file comments explaining Claude Code Action usage in `.github/workflows/llm-code-generation.yml`
- [ ] T019 [P] Document GitHub Secrets setup requirements (ANTHROPIC_API_KEY) in README or quickstart.md
- [ ] T020 [P] Add workflow file validation (check YAML syntax) before committing
- [ ] T021 [P] Test workflow with various prompt examples (simple, complex, multi-file)
- [ ] T022 [P] Verify error handling (test with invalid API key, empty prompt, etc.)
- [ ] T023 [P] Document optional configuration (model selection, max-turns, etc.) in workflow comments
- [ ] T024 [P] Run quickstart.md validation steps

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
- **User Story 1 (Phase 3)**: Depends on Foundational completion - Enables all functionality
- **User Story 2 (Phase 4)**: Depends on User Story 1 completion - Validation only (functionality already enabled)
- **User Story 3 (Phase 5)**: Depends on User Story 2 completion - Validation only (functionality already enabled)
- **Polish (Phase 6)**: Depends on all user stories being complete

### User Story Dependencies

- **User Story 1 (P1)**: Can start after Foundational (Phase 2) - Configures Claude Code Action
- **User Story 2 (P2)**: Automatically handled by Claude Code Action configured in US1 - Validation phase only
- **User Story 3 (P3)**: Automatically handled by Claude Code Action configured in US1 - Validation phase only

**Note**: Claude Code GitHub Actions handles all three user stories (code generation, branch/commit, PR creation) in a single action step. User Stories 2 and 3 are validation phases to verify the action works correctly.

### Within Each User Story

- Phase 3 (US1): Configure action ‚Üí Test code generation
- Phase 4 (US2): Validate branch creation and commits (automatic)
- Phase 5 (US3): Validate PR creation (automatic)
- Each phase validates independently before moving to next

### Parallel Opportunities

- Setup tasks T001-T002 can run sequentially (directory creation before file creation)
- Foundational tasks T003-T005 can run sequentially (each builds on previous)
- User Story 1 tasks T006-T010 can run sequentially (each adds configuration)
- User Story 2 validation tasks T011-T013 can run in parallel (different validations)
- User Story 3 validation tasks T014-T017 can run in parallel (different validations)
- Polish tasks T018-T024 marked [P] can run in parallel (different improvements)

---

## Parallel Example: User Story 2 Validation

```bash
# Launch all validation tasks for User Story 2 together:
Task: "Verify Claude Code Action creates branch automatically"
Task: "Verify Claude Code Action commits generated code files"
Task: "Verify branch naming follows expected pattern"
```

---

## Implementation Strategy

### MVP First (User Story 1 Only)

1. Complete Phase 1: Setup (create workflow directory and file)
2. Complete Phase 2: Foundational (configure triggers and permissions)
3. Complete Phase 3: User Story 1 (configure Claude Code Action)
4. **STOP and VALIDATE**: Test workflow with a prompt, verify code generation works
5. Deploy/demo if ready

**Note**: Once US1 is complete, US2 and US3 functionality is automatically available via Claude Code Action. Validation phases can be done later.

### Incremental Delivery

1. Complete Setup + Foundational ‚Üí Foundation ready
2. Add User Story 1 ‚Üí Test code generation ‚Üí Deploy/Demo (MVP!)
3. Validate User Story 2 ‚Üí Test branch/commit behavior ‚Üí Document
4. Validate User Story 3 ‚Üí Test PR creation ‚Üí Document
5. Add Polish improvements ‚Üí Finalize documentation

### Parallel Team Strategy

With multiple developers:

1. Team completes Setup + Foundational together
2. Once Foundational is done:
   - Developer A: User Story 1 (configure action)
   - Developer B: Prepare test prompts and validation checklist
3. After US1 completes:
   - Developer A: User Story 2 validation
   - Developer B: User Story 3 validation
   - Developer C: Polish improvements

---

## Notes

- **[P] tasks** = different validations or improvements, no dependencies
- **[Story] label** maps task to specific user story for traceability
- **Claude Code Action** handles all complex operations (LLM API, Git, PR creation) internally
- **User Stories 2 and 3** are validation phases - functionality is automatic via Claude Code Action
- **Each phase** should be validated independently before proceeding
- **Workflow testing** is manual via GitHub Actions UI (no automated tests needed for POC)
- **GitHub Secrets** must be configured before testing (ANTHROPIC_API_KEY)
- **Avoid**: Over-configuring Claude Code Action - it handles most operations automatically

---

## Task Summary

- **Total Tasks**: 24
- **Setup Phase**: 2 tasks
- **Foundational Phase**: 3 tasks
- **User Story 1**: 5 tasks (configuration)
- **User Story 2**: 3 tasks (validation)
- **User Story 3**: 4 tasks (validation)
- **Polish Phase**: 7 tasks

**MVP Scope**: Phases 1-3 (10 tasks total) - enables full functionality via Claude Code Action

